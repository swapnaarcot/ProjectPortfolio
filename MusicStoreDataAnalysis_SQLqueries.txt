--------------Easy------------------

1.Who is the seniormost employee based on job title?

select * from M_employee
order by levels desc;

2.Which countries have the most invoices?
select billing_country,count(invoice_id) from M_Invoice
group by Billing_Country order by 2 desc
;

3.What are the top 3 values of total invoice?

select Invoice_id,round(Total) Total_Invoice from  M_Invoice
order by Total desc;

4.Which city has the best customers?Write a city that has the highest sum of invoice totals?

select billing_city,round(sum(total))Total_Invoices from M_Invoice
group by billing_city order by Total_Invoices desc;


5.Who is the best customer(who spent more money)?

select c.customer_id,c.first_name,c.last_name,round(sum(i.total)) total
from M_customer c
join
M_invoice i
on c.customer_id=i.customer_id
group by c.customer_id,c.first_name,c.last_name order by total desc;

--------------Medium------------------------------------------------------------------

1.Write query to return the email,firstname,lastname and Genre for all Rock music listeners.Return in alphabetical order of email.

select distinct m.Customer_ID,m.First_Name,m.Last_Name,m.Email,g.Genre_Id,g.Name
from M_Customer m
join
M_Invoice i
on m.Customer_id=i.Customer_id
join
M_Invoiceline il
on i.Invoice_id=il.Invoice_id
join
M_Track t
on
il.track_id=t.track_id
join 
M_Genre g
on t.genre_id=g.genre_id 
where g.name='Rock'
order by m.Email;

2. Write a query that returns the Artist name and total track count of top 10 rock bands.

select at.artist_id,at.name,count(tr.Track_id)Track_count
from
M_Artist at
join
M_Album al
on at.artist_id=al.artist_id
join
M_track tr
on al.album_id=tr.album_id
join
M_Genre g
on tr.genre_id=g.genre_id
where g.genre_id=1
group by at.name , at.artist_id order by 3 desc;

3. Return all the track names that have a song length longer than the average song length .Return the name
 and milliseconds for each track.Order the song length with longest songs listed first.

select * from M_track where
milliseconds >
(
select avg(milliseconds) from M_track)
order by milliseconds desc;

--------------Advance---------------------------------------------------------------

1.Find how much money spent by each customer on artists?Write a query to return customer name,artist name and total spent?

select  mi.customer_id,mc.first_name,mar.artist_id,mar.name,sum(mil.unit_price*mil.quantity)
from M_customer mc
join
M_invoice mi on mc.customer_id=mi.customer_id
join
M_invoiceline mil on mi.invoice_id=mil.invoice_id
join
M_track t on mil.track_id=t.track_id
join
M_album ma on t.album_id=ma.album_id
join
M_artist mar on ma.artist_id=mar.artist_id
group by mi.customer_id,mc.first_name,mar.artist_id,mar.name order by 4; 


2.Find the most popular music genre for each country.For countries where maximum number of purchases is shared ,return all genres.

with popular_genre as
(
select mi.billing_country,sum(mil.quantity)Total_quantity,mg.genre_id,mg.name,
row_number() over(partition by mi.billing_country order by sum(mil.quantity)desc)Rno
from M_invoice mi 
join M_Invoiceline mil on mi.invoice_id=mil.invoice_id
join M_track mt on mil.track_id=mt.track_id
join M_genre mg on mt.genre_id=mg.genre_id
group by mi.billing_country,mg.genre_id,mg.name
)
select * from popular_genre where Rno<=1;


3. Write a query that determines the customer who spent the most on music for each country.

select * from
(select mi.customer_id,mc.first_name,mc.last_name,mi.billing_country,round(sum(mi.total),2)Total_spent,
row_number() over(partition by mi.billing_country order by sum(mi.total) desc)Rn
from M_Invoice mi
join M_Customer mc
on mi.customer_id=mc.customer_id
group by mi.customer_id,mc.first_name,mc.last_name,mi.billing_country order by 2,3 desc)
where Rn<=1;




